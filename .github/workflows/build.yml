name: build

# Controls when the action will run. 
on: [push, pull_request]

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  tests:
      runs-on: ubuntu-latest
      timeout-minutes: 30
      strategy:
        matrix:
          python-version: ['3.10', '3.11', '3.12', '3.13']
      steps:
        - uses: actions/checkout@v2
        - name: Set up Python ${{matrix.python-version}}
          uses: actions/setup-python@v2
          with:
            python-version: ${{matrix.python-version}}
        - name: Install Python dependencies
          run: |
            pip install --upgrade pip
            pip install -r requirements.txt
            pip install -U numpy
            pip install mypy
            pip install types-PyYAML
            pip install pytest
            pip install pytest-cov
            pip install pylint
            pip install coveralls
            pip install .
            pip list
        - name: Run tests
          run: |
            pytest --cov-config=.coveragerc --cov=vasppy --cov-report=xml --cov-report=term
        - name: Debug - Check coverage file
          if: matrix.python-version == '3.12'
          run: |
            ls -la coverage.xml
            head -n 20 coverage.xml
        - name: Upload to Coveralls
          if: matrix.python-version == '3.12'
          env:
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          run: |
            coveralls --service=github
        - name: Static type checking
          run: |
            mypy vasppy
        - name: PyLint
          run: |
              pylint --errors-only vasppy
